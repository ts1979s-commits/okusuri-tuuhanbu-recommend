# お薬通販部商品レコメンドLLMアプリ - 本番運用セットアップガイド

## 🚀 本番運用開始手順

### 1. 環境設定
```bash
# .envファイルを作成（OpenAI API Keyを設定）
copy .env.example .env
# .envファイルを編集してOPENAI_API_KEYを実際のキーに変更
```

### 2. 仮想環境とパッケージ
```bash
# 仮想環境がactivateされていることを確認
.\env\Scripts\activate

# 必要に応じて追加パッケージをインストール
pip install pandas matplotlib seaborn
```

### 3. システム起動
```bash
# メインアプリケーション起動
python main.py
```

## 📋 本番運用メニュー構成

### 1. 商品データ収集 (スクレイピング)
- サンプルデータを使用した商品情報収集
- タイムスタンプ付きファイルで履歴管理
- NDJSON/CSV/SQLite形式で自動保存

### 2. データ処理・エクスポート
- 各種形式でのデータエクスポート
- FAISSインデックス再構築
- データ品質チェック
- 重複データ除去

### 3. 商品検索・レコメンド (CLI)
- 自然言語での商品検索
- 類似度スコア付き結果表示
- インタラクティブな検索セッション

### 4. Web UI (Streamlit)
- ブラウザベースの操作画面
- 検索・レコメンド機能
- データ可視化

### 5. システム状態確認
- 全コンポーネントの動作状況確認
- データ統計情報表示
- 推奨アクションの提示

### 6. データバックアップ
- 自動ZIP圧縮バックアップ
- タイムスタンプ付きアーカイブ
- データ・ログの包括的保存

### 7. データ分析・統計
- カテゴリー別統計
- 人気タグランキング
- データ品質レポート
- JSON形式での詳細レポート保存

### 8. システム設定
- 現在の設定値表示
- ファイル存在確認
- ディスク使用量確認

## 🛡️ 本番運用の注意点

### セキュリティ
- .envファイルは必ずGit管理対象外に設定
- OpenAI API Keyは環境変数で管理
- スクレイピング間隔を適切に設定（現在1秒）

### パフォーマンス
- 大量データ処理時はバッチサイズを調整
- FAISSインデックスは定期的に再構築
- 古いバックアップファイルは定期削除

### 監視・運用
- ログファイル（logs/app.log）を定期確認
- データ品質チェックを定期実行
- システム状態確認を日次実行

### スケーラビリティ
- 商品数が1万件を超える場合はFAISSの設定調整を検討
- SQLiteは10万件程度まで対応可能
- それ以上はPostgreSQL等への移行を検討

## 🔄 推奨運用フロー

### 日次運用
1. システム状態確認
2. 新規商品データ収集
3. FAISSインデックス更新
4. データ分析レポート確認

### 週次運用
1. 完全バックアップ実行
2. データ品質チェック
3. ログファイルローテーション

### 月次運用
1. パフォーマンス分析
2. 古いバックアップの整理
3. システム設定見直し

## 🆘 トラブルシューティング

### よくある問題
1. **OpenAI API接続エラー**
   - .envファイルのAPI Key確認
   - インターネット接続確認
   - API利用制限確認

2. **FAISSインデックスエラー**
   - データフォルダの権限確認
   - メモリ不足の場合はバッチサイズ削減
   - インデックス再構築実行

3. **Streamlit起動エラー**
   - ポート8501が使用中でないか確認
   - app.pyファイルの存在確認
   - パッケージインストール状況確認

### ログ確認
```bash
# 最新のログを確認
tail -f logs/app.log

# エラーログのみフィルタ
grep "ERROR" logs/app.log
```

## 📊 推奨監視指標

- 商品データ総数
- FAISSインデックス件数
- 日次データ収集件数
- 検索クエリ成功率
- システム応答時間
- ディスク使用量