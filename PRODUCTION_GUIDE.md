# お薬通販部商品レコメンドAI - 本番運用セットアップガイド

## 🚀 本番運用開始手順

### 1. 環境設定
- 通常運用（Web UIのみ）では`.env`やAPIキーは不要です。
- AI/FAISS連携（オプション機能）を利用する場合のみ、`.env`にOpenAI API Keyを設定してください。

```bash
# OpenAI API利用時のみ
copy .env.example .env
# .envファイルを編集してOPENAI_API_KEYを実際のキーに変更
```

### 2. 仮想環境とパッケージ
```bash
# 仮想環境がactivateされていることを確認
.\env\Scripts\activate

# 必要に応じて追加パッケージをインストール
pip install pandas  # 通常運用はpandasのみでOK
# AI/可視化/分析用途で必要な場合のみ
pip install matplotlib seaborn
```

### 3. システム起動
- 通常はWeb UI（Streamlit）で運用します。
```bash
streamlit run app.py
```
- CLIやAI/FAISS連携を利用する場合のみ、main.py等の補助スクリプトを利用してください。

---

## 📋 本番運用メニュー構成

### 1. 商品データ収集
- サンプルデータやスクレイピングで商品情報収集
- タイムスタンプ付きファイルで履歴管理
- NDJSON/CSV/SQLite形式で保存

### 2. データ処理・エクスポート
- 各種形式でのデータエクスポート
- データ品質チェック
- 重複データ除去
- FAISSインデックス再構築（オプション/AI利用時のみ）

### 3. 商品検索・レコメンド
- 通常はWeb UI（Streamlit）で検索・レコメンド
- CLIやAI/FAISS連携はオプション

### 4. Web UI (Streamlit)
- ブラウザベースの操作画面
- 検索・レコメンド機能
- データ可視化

### 5. システム状態確認
- 全コンポーネントの動作状況確認
- データ統計情報表示
- 推奨アクションの提示

### 6. データバックアップ
- 必要に応じて手動でZIP圧縮バックアップ
- タイムスタンプ付きアーカイブ

### 7. データ分析・統計
- カテゴリー別統計
- 人気タグランキング
- データ品質レポート
- JSON形式での詳細レポート保存

### 8. システム設定
- 現在の設定値表示
- ファイル存在確認
- ディスク使用量確認

---

## 🛡️ 本番運用の注意点

### セキュリティ
- .envファイルはAI/FAISS連携時のみ必要。必ずGit管理対象外に設定
- OpenAI API Keyは環境変数で管理
- スクレイピング間隔を適切に設定（現在1秒）

### パフォーマンス
- 大量データ処理時はバッチサイズを調整
- FAISSインデックスはAI/ベクトル検索利用時のみ再構築
- 古いバックアップファイルは定期削除

### 監視・運用
- ログファイル（logs/app.log）を定期確認
- データ品質チェックを定期実行
- システム状態確認を日次実行

### スケーラビリティ
- 商品数が1万件を超える場合はFAISSの設定調整を検討（AI/ベクトル検索利用時のみ）
- SQLiteは10万件程度まで対応可能
- それ以上はPostgreSQL等への移行を検討

---

## 🔄 推奨運用フロー

### 日次運用
1. システム状態確認
2. 新規商品データ収集
3. 必要に応じてデータ分析レポート確認
4. （AI/FAISS利用時のみ）FAISSインデックス更新

### 週次運用
1. 完全バックアップ実行
2. データ品質チェック
3. ログファイルローテーション

### 月次運用
1. パフォーマンス分析
2. 古いバックアップの整理
3. システム設定見直し

---

## 🆘 トラブルシューティング

### よくある問題
1. **OpenAI API接続エラー**（AI/FAISS連携時のみ）
   - .envファイルのAPI Key確認
   - インターネット接続確認
   - API利用制限確認

2. **FAISSインデックスエラー**（AI/FAISS連携時のみ）
   - データフォルダの権限確認
   - メモリ不足の場合はバッチサイズ削減
   - インデックス再構築実行

3. **Streamlit起動エラー**
   - ポート8501が使用中でないか確認
   - app.pyファイルの存在確認
   - パッケージインストール状況確認

### ログ確認
```bash
# 最新のログを確認
tail -f logs/app.log

# エラーログのみフィルタ
grep "ERROR" logs/app.log
```

---

## 📊 推奨監視指標

- 商品データ総数
- （AI/FAISS利用時のみ）FAISSインデックス件数
- 日次データ収集件数
- 検索クエリ成功率
- システム応答時間
- ディスク使用量